<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event & Fightcard Management</title>
    <style>
                .event-select-compact {
                    width: 300px;
                    max-width: 90vw;
                    display: block;
                    margin-bottom: 15px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 4px;
                    font-size: 16px;
                    box-sizing: border-box;
                }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        h2 {
            color: #333;
        }
        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        table th, table td {
            padding: 10px;
            border: 1px solid #ccc;
        }
        table th {
            background-color: #f4f4f4;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        @media (max-width: 600px) {
            form {
                padding: 15px;
                width: 90%;
            }
        }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Load Fighters on Page Load
            loadFighters();

            // Load Events on Page Load
            loadEvents();

            // Add Event Form Submission
            document.getElementById("addEventForm").addEventListener("submit", function (event) {
                event.preventDefault();
                const formData = new FormData(this);

                fetch("manage_events.php?action=add", {
                    method: "POST",
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert("Event erfolgreich hinzugefügt!");
                        loadEvents();
                        this.reset();
                    } else {
                        alert("Fehler: " + data.message);
                    }
                });
            });

            // Add Fightcard Form Submission
            document.getElementById("addFightForm").addEventListener("submit", function (event) {
                event.preventDefault();
                const formData = new FormData(this);
                formData.set("event_id", document.getElementById("eventSelect").value);

                fetch("manage_fightcards.php?action=add", {
                    method: "POST",
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert("Kampf erfolgreich hinzugefügt!");
                        loadFightcard(formData.get("event_id"));
                        this.reset();
                    } else {
                        alert("Fehler: " + data.message);
                    }
                });
            });

            // Event Selection Change
            document.getElementById("eventSelect").addEventListener("change", function () {
                const eventId = this.value;
                if (eventId) {
                    loadFightcard(eventId);
                }
            });
        });

        // Load Fighters
        function loadFighters() {
            fetch("get_fighters.php")
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const fighter1Select = document.getElementById("fighter1_id");
                        const fighter2Select = document.getElementById("fighter2_id");

                        // Clear existing options
                        fighter1Select.innerHTML = "<option value=''>Kämpfer auswählen</option>";
                        fighter2Select.innerHTML = "<option value=''>Kämpfer auswählen</option>";

                        // Populate dropdowns with fighter data
                        data.data.forEach(fighter => {
                            const option1 = document.createElement("option");
                            option1.value = fighter.id;
                            option1.textContent = fighter.name;

                            const option2 = document.createElement("option");
                            option2.value = fighter.id;
                            option2.textContent = fighter.name;

                            fighter1Select.appendChild(option1);
                            fighter2Select.appendChild(option2);
                        });
                    }
                });
        }

        // Load Events
        function loadEvents() {
            fetch("manage_events.php?action=list")
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const eventSelect = document.getElementById("eventSelect");
                        eventSelect.innerHTML = "<option value=''>Event auswählen</option>";

                        data.data.forEach(event => {
                            const option = document.createElement("option");
                            option.value = event.id;
                            option.textContent = `${event.name} - ${event.datum}`;
                            eventSelect.appendChild(option);
                        });
                    }
                });
        }

        // Load Fightcard for an Event
        function loadFightcard() {
            fetch(`manage_fightcards.php?action=list`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const fightcardTable = document.getElementById("fightcardTableBody");
                        fightcardTable.innerHTML = "";

                        data.data.forEach(fight => {
                            const row = document.createElement("tr");
                            row.innerHTML = `
                                <td>${fight.event_name}</td>
                                <td>${fight.fighter1_name}</td>
                                <td>${fight.fighter2_name}</td>
                                <td>${fight.fight_order}</td>
                            `;
                            fightcardTable.appendChild(row);
                        });
                    }
                });
        }

        // Beim Laden der Seite die Fightcards automatisch laden
document.addEventListener("DOMContentLoaded", function () {
    loadFightcard();
});

// Load Organisations
function loadOrganisations() {
    fetch("get_organisations.php")
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const organisationSelect = document.getElementById("organisation_id");
                organisationSelect.innerHTML = "<option value=''>Organisation auswählen</option>";

                data.data.forEach(org => {
                    const option = document.createElement("option");
                    option.value = org.id;
                    option.textContent = org.name;
                    organisationSelect.appendChild(option);
                });
            }
        });
}

// Beim Laden der Seite Organisationen laden
document.addEventListener("DOMContentLoaded", function () {
    loadOrganisations();
});
    </script>
</head>
<body>
    <h2>Event Management</h2>
    <form id="addEventForm">
        <label for="name">Event Name:</label>
        <input type="text" id="name" name="name" required>

        <!-- Image Upload Field -->
        <label for="eventImage">Event-Bild hochladen:</label>
        <div id="eventImageDropArea" style="border:2px dashed #ccc; border-radius:8px; padding:16px; text-align:center; margin-bottom:15px; background:#fafafa; cursor:pointer;">
            <span id="eventImageDropText">Bild hierher ziehen oder klicken</span>
            <input type="file" id="eventImage" name="eventImage" accept="image/*" style="display:none;">
            <div style="position:relative; display:inline-block; width:100%;">
                <img id="eventImagePreview" src="" alt="Bildvorschau" style="display:none; max-width:100%; margin-top:10px; border-radius:8px;" />
                <span id="removeEventImageIcon" title="Bild entfernen" style="display:none; position:absolute; top:18px; right:18px; background:rgba(0,0,0,0.6); color:#fff; border-radius:50%; width:28px; height:28px; line-height:28px; text-align:center; font-size:18px; font-weight:bold; cursor:pointer; z-index:2;">&#10006;</span>
            </div>
        </div>

        <label for="organisation_id">Organisation:</label>
        <select id="organisation_id" name="organisation_id" required>
            <option value="">Organisation auswählen</option>
        </select>

        <label for="datum">Datum:</label>
        <input type="date" id="datum" name="datum" >

        <label for="austragungsort">Austragungsort:</label>
        <input type="text" id="austragungsort" name="austragungsort" required>

        <label for="uhrzeit">Uhrzeit:</label>
        <input type="time" id="uhrzeit" name="uhrzeit">

        <label for="streaming_service">Streaming-Service:</label>
        <input type="text" id="streaming_service" name="streaming_service">

        <label for="ticket_link">Ticket-Link:</label>
        <input type="url" id="ticket_link" name="ticket_link">

        <button type="submit">Event hinzufügen</button>
    </form>

    <h2>Fightcard Management</h2>
    <label for="eventSelect">Event auswählen:</label>
    <select id="eventSelect" class="event-select-compact" required>
        <option value="">Event auswählen</option>
    </select>

    <form id="addFightForm">
        <label for="fighter1_id">Kämpfer 1:</label>
        <select id="fighter1_id" name="fighter1_id" required>
            <option value="">Kämpfer auswählen</option>
        </select>

        <label for="fighter2_id">Kämpfer 2:</label>
        <select id="fighter2_id" name="fighter2_id" required>
            <option value="">Kämpfer auswählen</option>
        </select>

        <label for="fight_order">Kampf Reihenfolge:</label>
        <input type="number" id="fight_order" name="fight_order" required>

        <button type="submit">Kampf hinzufügen</button>
    </form>

    <h2>Fightcard</h2>
    <table>
        <thead>
            <tr>
                <th>Event</th>
                <th>Kämpfer 1</th>
                <th>Kämpfer 2</th>
                <th>Reihenfolge</th>
            </tr>
        </thead>
        <tbody id="fightcardTableBody">
        </tbody>
    </table>
</body>
</html>

<script>
// Drag & Drop Image Upload for Event
document.addEventListener('DOMContentLoaded', function() {
    const imageDropArea = document.getElementById('eventImageDropArea');
    const eventImageInput = document.getElementById('eventImage');
    const imagePreview = document.getElementById('eventImagePreview');
    const imageDropText = document.getElementById('eventImageDropText');
    const removeEventImageIcon = document.getElementById('removeEventImageIcon');

    imageDropArea.addEventListener('click', () => {
        eventImageInput.click();
    });

    imageDropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        imageDropArea.style.background = '#e0ffe0';
    });

    imageDropArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        imageDropArea.style.background = '#fafafa';
    });

    imageDropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        imageDropArea.style.background = '#fafafa';
        if (e.dataTransfer.files && e.dataTransfer.files[0]) {
            eventImageInput.files = e.dataTransfer.files;
            showImagePreview(e.dataTransfer.files[0]);
        }
    });

    eventImageInput.addEventListener('change', (e) => {
        if (e.target.files && e.target.files[0]) {
            showImagePreview(e.target.files[0]);
        }
    });

    function showImagePreview(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            imagePreview.src = e.target.result;
            imagePreview.style.display = 'block';
            imageDropText.style.display = 'none';
            removeEventImageIcon.style.display = 'block';
        };
        reader.readAsDataURL(file);
    }

    removeEventImageIcon.addEventListener('click', function(e) {
        e.stopPropagation();
        eventImageInput.value = '';
        imagePreview.src = '';
        imagePreview.style.display = 'none';
        imageDropText.style.display = 'inline';
        removeEventImageIcon.style.display = 'none';
    });
});
</script>
